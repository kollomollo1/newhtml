<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØµÙˆØ± Ø§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙ‚Ø·</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      padding: 20px;
      background: #f5f5f5;
      text-align: center;
    }
    h2 {
      color: #333;
      margin-bottom: 20px;
    }
    .seller-section {
      margin-bottom: 30px;
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .seller-section h3 {
      color: green;
      margin-bottom: 10px;
    }
    .img-box {
      display: inline-block;
      width: 130px;
      margin: 10px;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    .img-box img {
      width: 100%;
      border-radius: 6px;
      background: #ccc;
    }
    .btns {
      margin-top: 8px;
      display: flex;
      justify-content: center;
      gap: 6px;
    }
    .btns button {
      padding: 4px 6px;
      font-size: 12px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }
    .approve-btn { background: #28a745; }
    .delete-btn { background: #dc3545; }
  </style>
</head>
<body>

  <h2>ğŸ“¸ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ÙÙ‚Ø·</h2>
  <div id="container">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCP2gI3kFHg-ExtEhyMLlBe4o0yXHHXV6E",
      authDomain: "gallery3modifiedjsless.firebaseapp.com",
      projectId: "gallery3modifiedjsless",
      storageBucket: "gallery3modifiedjsless.appspot.com",
      messagingSenderId: "437182767215",
      appId: "1:437182767215:web:0705b90e7009337a85ad9a"
    };

    firebase.initializeApp(firebaseConfig);

    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù† ÙÙ‚Ø·
    firebase.auth().onAuthStateChanged(user => {
      if (!user || user.email !== "kollomollo1@gmail.com") {
        alert("ğŸš« ØºÙŠØ± Ù…ØµØ±Ø­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„");
        window.location.href = "admin-login.html";
      } else {
        loadPendingImages(); // ØªØ´ØºÙŠÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯
      }
    });

    function loadPendingImages() {
      const pendingUrl = "https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/pendingImages.json";
      const imagesUrl = "https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/images.json";

      const container = document.getElementById("container");

      fetch(pendingUrl)
        .then(res => res.json())
        .then(data => {
          if (!data || Object.keys(data).length === 0) {
            container.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…Ø¹Ù„Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
            return;
          }

          const sellersMap = {};

          Object.entries(data).forEach(([key, img]) => {
            const seller = img.sellerName || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
            if (!sellersMap[seller]) sellersMap[seller] = [];
            sellersMap[seller].push({ key, ...img });
          });

          container.innerHTML = "";

          Object.entries(sellersMap).forEach(([sellerName, images]) => {
            const section = document.createElement("div");
            section.className = "seller-section";

            const sellerTitle = document.createElement("h3");
            sellerTitle.textContent = `ğŸ›ï¸ ${sellerName}`;
            section.appendChild(sellerTitle);

            images.forEach(img => {
              const div = document.createElement("div");
              div.className = "img-box";

              const image = document.createElement("img");
              image.src = img.src;

              const btnGroup = document.createElement("div");
              btnGroup.className = "btns";

              const approveBtn = document.createElement("button");
              approveBtn.textContent = "âœ…";
              approveBtn.className = "approve-btn";
              approveBtn.onclick = () => {
                const approvedImage = {
                  id: Date.now() + Math.random(),
                  src: img.src,
                  seller: img.seller || "#",
                  trader: img.sellerName || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                  category: img.category || "ØºÙŠØ± Ù…ØµÙ†Ù",
                  group: Date.now()
                };
                fetch(imagesUrl, {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify(approvedImage)
                }).then(() => {
                  return fetch(`${pendingUrl.replace(".json", "/" + img.key + ".json")}`, {
                    method: "DELETE"
                  });
                }).then(() => div.remove());
              };

              const delBtn = document.createElement("button");
              delBtn.textContent = "ğŸ—‘ï¸";
              delBtn.className = "delete-btn";
              delBtn.onclick = () => {
                if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©ØŸ")) {
                  fetch(`${pendingUrl.replace(".json", "/" + img.key + ".json")}`, {
                    method: "DELETE"
                  }).then(() => div.remove());
                }
              };

              btnGroup.appendChild(approveBtn);
              btnGroup.appendChild(delBtn);

              div.appendChild(image);
              div.appendChild(btnGroup);
              section.appendChild(div);
            });

            container.appendChild(section);
          });
        })
        .catch(err => {
          container.textContent = "ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±.";
          console.error(err);
        });
    }
  </script>
</body>
</html>
