<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ - Ø±ÙØ¹ ØµÙˆØ±Ø©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCP2gI3kFHg-ExtEhyMLlBe4o0yXHHXV6E",
      authDomain: "gallery3modifiedjsless.firebaseapp.com",
      databaseURL: "https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gallery3modifiedjsless",
      storageBucket: "gallery3modifiedjsless.firebasestorage.app",
      messagingSenderId: "437182767215",
      appId: "1:437182767215:web:0705b90e7009337a85ad9a"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 20px;
      margin-top: 60px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 700px;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¨Ø§Ø¦Ø¹ - Ø±ÙØ¹ ØµÙˆØ±Ø©</h2>

    <input type="file" id="fileInput" accept="image/*">
    <select id="category">
      <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
      <option value="ÙƒØ§Ø´Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ">ÙƒØ§Ø´Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ</option>
      <option value="Ø¨ÙŠØ¬Ø§Ù…Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ ÙˆÙ…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¨ÙŠØª">Ø¨ÙŠØ¬Ø§Ù…Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ ÙˆÙ…Ù„Ø§Ø¨Ø³ Ø§Ù„Ø¨ÙŠØª</option>
      <option value="Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ù„ ÙˆØ§Ù„Ù…ÙƒÙŠØ§Ø¬Ø§Øª">Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ù„ ÙˆØ§Ù„Ù…ÙƒÙŠØ§Ø¬Ø§Øª</option>
      <option value="Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ">Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø­Ø±ÙŠÙ…ÙŠ</option>
      <option value="Ù…Ù„Ø§Ø¨Ø³ Ø®Ø±ÙˆØ¬ Ø­Ø±ÙŠÙ…ÙŠ">Ù…Ù„Ø§Ø¨Ø³ Ø®Ø±ÙˆØ¬ Ø­Ø±ÙŠÙ…ÙŠ</option>
      <option value="Ø´Ù†Ø· ÙˆØ£Ø­Ø°ÙŠØ© Ø­Ø±ÙŠÙ…ÙŠ">Ø´Ù†Ø· ÙˆØ£Ø­Ø°ÙŠØ© Ø­Ø±ÙŠÙ…ÙŠ</option>
      <option value="Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©">Ø£Ø¯ÙˆØ§Øª Ù…Ù†Ø²Ù„ÙŠØ©</option>
      <option value="Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ© Ø£Ø·ÙØ§Ù„ÙŠ">Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ© Ø£Ø·ÙØ§Ù„ÙŠ</option>
      <option value="Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ© Ø±Ø¬Ø§Ù„ÙŠ">Ù…Ù„Ø§Ø¨Ø³ ÙˆØ£Ø­Ø°ÙŠØ© Ø±Ø¬Ø§Ù„ÙŠ</option>
    </select>

    <input type="text" id="sellerPhone" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø«Ø§Ù„: 01012345678">
    <button onclick="uploadImage()">Ø±ÙØ¹</button>

    <h3 style="text-align:center">ØµÙˆØ±Ùƒ Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
    <div id="myImages" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px;"></div>
  </div>

  <script>
    let sellerName = "";

    function uploadImage() {
      const file = document.getElementById("fileInput").files[0];
      const category = document.getElementById("category").value;
      let phone = document.getElementById("sellerPhone").value.trim();

      if (phone.startsWith("0")) phone = phone.substring(1);
      const sellerLink = phone ? `https://wa.me/20${phone}` : "";

      if (!file || !category || !sellerName || !sellerLink) {
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
        return;
      }

      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "lastlast");

      fetch("https://api.cloudinary.com/v1_1/dugzs3qbh/image/upload", {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        const newImg = {
          src: data.secure_url,
          sellerName: sellerName,
          trader: sellerName,
          seller: sellerLink,
          category: category,
          approved: false,
          email: firebase.auth().currentUser.email,
          uid: firebase.auth().currentUser?.uid || "guest"
        };

        console.log("ğŸ”¥ newImg:", newImg);

        return firebase.auth().currentUser.getIdToken().then(token => {
          return fetch("https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/pendingImages.json?auth=" + token, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(newImg)
          });
        });
      })
      .then(() => {
        alert("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªÙ†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ø£Ø¯Ù…Ù†");
        loadMyImages();
      })
      .catch(err => {
        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: " + err.message);
      });
    }

    function loadMyImages() {
      const container = document.getElementById("myImages");
      container.innerHTML = "";
      const sources = [
        { url: "https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/pendingImages.json", deletable: true },
        { url: "https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/images.json", deletable: true }
      ];

      sources.forEach(source => {
        fetch(source.url).then(res => res.json()).then(data => {
          if (!data) return;
          Object.entries(data).forEach(([key, img]) => {
            if (img.sellerName === sellerName || img.trader === sellerName) {
              const div = document.createElement("div");
              div.style.position = "relative";
              const image = document.createElement("img");
              image.src = img.src;
              image.style.width = "100%";
              image.style.borderRadius = "6px";
              div.appendChild(image);
              const btn = document.createElement("button");
              btn.textContent = "âŒ Ø­Ø°Ù";
              btn.style.cssText = "position:absolute;bottom:6px;right:6px;padding:4px 8px;background:#dc3545;color:white;border:none;border-radius:4px;cursor:pointer";
              btn.onclick = () => {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø©ØŸ")) {
    firebase.auth().currentUser.getIdToken().then(token => {
      fetch(`${source.url.replace(".json", "/" + key + ".json")}?auth=${token}`, {
        method: "DELETE"
      }).then(() => loadMyImages());
    }).catch(err => {
      alert("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„");
      console.error(err);
    });
  }
};
              div.appendChild(btn);
              container.appendChild(div);
            }
          });
        });
      });
    }

    window.onload = () => {
      firebase.auth().onAuthStateChanged((user) => {
        if (user) {
          const uid = user.uid;
          firebase.auth().currentUser.getIdToken().then(token => {
            return fetch("https://gallery3modifiedjsless-default-rtdb.europe-west1.firebasedatabase.app/sellers/" + uid + ".json?auth=" + token);
          })
          .then(res => res.json())
          .then(data => {
            if (data && data.shopName) {
              sellerName = data.shopName;
              loadMyImages();
            } else {
              alert("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø³Ù… Ù…ØªØ¬Ø± Ù…Ø±ØªØ¨Ø· Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨");
            }
          });
        } else {
          alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
          window.location.href = "login.html";
        }
      });
    };
  </script>
</body>
</html>
